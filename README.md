
# ASCII 3D Cube

ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ C++ ã‚’ç”¨ã„ã¦ ASCII ã‚¢ãƒ¼ãƒˆã§ 3D ã®ç«‹æ–¹ä½“ã‚’æç”»ã—ã€å›è»¢ã•ã›ã‚‹ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚  
ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§ç«‹æ–¹ä½“ãŒã‚†ã£ãã‚Šå›è»¢ã—ã¦ã„ãæ§˜å­ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

!(CubeRotation.gif)

## ãƒ‡ãƒ¢ã®æ¦‚è¦

- ASCII æ–‡å­—ã‚’ä½¿ã£ã¦ç”»é¢ä¸Šã« 3D ç«‹æ–¹ä½“ã‚’æç”»  
- A, B, C ã¨ã„ã† 3 ã¤ã®å›è»¢è§’åº¦ã‚’ç”¨ã„ã¦ã€X, Y, Z è»¸æ–¹å‘ã«å›è»¢ã‚’åŠ ãˆã¦ã„ã¾ã™  
- å„é¢ã«ç•°ãªã‚‹æ–‡å­— (`@`, `$`, `~`, `#`, `;`, `+`) ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã§ã€ç«‹æ–¹ä½“ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã‚„ã™ããªã£ã¦ã„ã¾ã™  
- Z ãƒãƒƒãƒ•ã‚¡ã‚’ç”¨ã„ã€å¥¥ã«ã‚ã‚‹é¢ãŒæ‰‹å‰ã®é¢ã«ä¸Šæ›¸ãã•ã‚Œãªã„ã‚ˆã†ã«æç”»ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™

## ä»•çµ„ã¿

1. **åº§æ¨™å¤‰æ› (calculateX, calculateY, calculateZ)**
   - 3D ç©ºé–“ä¸Šã® `(x, y, z)` åº§æ¨™ã‚’å›è»¢è¡Œåˆ—ã§å¤‰æ›ã™ã‚‹å‡¦ç†ã§ã™ã€‚
   - ãã‚Œãã‚Œ \( A, B, C \) (X, Y, Z è»¸å›è»¢è§’) ã‚’ã‚‚ã¨ã«å›è»¢å¾Œã®ä½ç½®ã‚’è¨ˆç®—ã—ã€è¦–ç‚¹æ–¹å‘ã«æŠ•å½±ã—ã¾ã™ã€‚

2. **æŠ•å½± (ooz = 1 / z)**
   - è·é›¢ã«å¿œã˜ãŸå¥¥è¡Œãã‚’è€ƒæ…®ã™ã‚‹ãŸã‚ã«ã€`1 / z` ã‚’ç”¨ã„ã‚‹ç°¡æ˜“çš„ãªé€è¦–æŠ•å½±ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
   - ã“ã‚Œã«ã‚ˆã‚Šã€å¥¥ã«ã‚ã‚‹ç‚¹ãŒæ‰‹å‰ã‚ˆã‚Šã‚‚å°ã•ãæç”»ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

3. **Z ãƒãƒƒãƒ•ã‚¡ (zBuffer)**
   - ç”»é¢ä¸Šã®å„ãƒ”ã‚¯ã‚»ãƒ«ã«å¯¾ã—ã¦ã€ã„ã¾æç”»ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ç‚¹ã®â€œå¥¥è¡Œãâ€ã‚’æ¯”è¼ƒã—ã€  
     ã‚ˆã‚Šæ‰‹å‰ã«ã‚ã‚‹ç‚¹ (`ooz` å€¤ãŒå¤§ãã„ç‚¹) ã‚’å„ªå…ˆã—ã¦æç”»ã—ã¦ã„ã¾ã™ã€‚
   - ã“ã‚Œã«ã‚ˆã‚Šã€ç«‹ä½“æ„Ÿã‚’ä¿ã£ãŸã¾ã¾æ­£ã—ã„é‡ãªã‚Šé †ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

4. **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**
   - ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—å†…ã§ A, B, C ã®å€¤ã‚’å°‘ã—ãšã¤å¤‰åŒ–ã•ã› (ä¾‹: `A += 0.05; B += 0.05; C += 0.01;` )ã€  
     ãƒ«ãƒ¼ãƒ—ã‚’å›ã—ç¶šã‘ã‚‹ã“ã¨ã§é€£ç¶šçš„ã«å›è»¢ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦

```cpp
// å›è»¢è§’åº¦ (ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°)
float A, B, C;

// ç”»é¢ã‚µã‚¤ã‚ºã€ç«‹æ–¹ä½“ã®å¹…ç­‰ã®è¨­å®š
int width = 160;
int height = 44;
float cubeWidth = 20;

// Z ãƒãƒƒãƒ•ã‚¡ã¨ç”»é¢ãƒãƒƒãƒ•ã‚¡
float zBuffer[160 * 44];
char buffer[160 * 44];
int backgroundASCIICode = ' ';  // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã®æ–‡å­— (ç©ºç™½)

// ã‚«ãƒ¡ãƒ©ã‹ã‚‰ã®è·é›¢ã‚„æŠ•å½±ç”¨ã®ä¿‚æ•°
int distanceFromCam = 100;
float K1 = 40;
```

- **`A, B, C`** ã¯ X, Y, Z è»¸å›è»¢ã®è§’åº¦ã§ã™ã€‚  
- **`zBuffer` ã¨ `buffer`** ã¯ã€æç”»æ™‚ã® Z ãƒãƒƒãƒ•ã‚¡ã¨ ASCII ãƒãƒƒãƒ•ã‚¡ã§ã™ã€‚  
  ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§å¯¾å¿œã™ã‚‹ç”»é¢åº§æ¨™ \((x + y * width)\) ã«ä¿ç®¡ã—ã¾ã™ã€‚  
- **`distanceFromCam`** ã¯ã‚«ãƒ¡ãƒ© (è¦–ç‚¹) ã¨æŠ•å½±é¢ã®è·é›¢ã€‚  
- **`K1`** ã¯é€è¦–æŠ•å½±ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ä¿‚æ•°ã§ã™ã€‚

```cpp
float calculateX(int i, int j, int k) {
    // X åº§æ¨™å¤‰æ›
    return j * sin(A) * sin(B) * cos(C)
         - k * cos(A) * sin(B) * cos(C)
         + j * cos(A) * sin(C)
         + k * sin(A) * sin(C)
         + i * cos(B) * cos(C);
}

float calculateY(int i, int j, int k) {
    // Y åº§æ¨™å¤‰æ›
    return j * cos(A) * cos(C)
         + k * sin(A) * cos(C)
         - j * sin(A) * sin(B) * sin(C)
         + k * cos(A) * sin(B) * sin(C)
         - i * cos(B) * sin(C);
}

float calculateZ(int i, int j, int k) {
    // Z åº§æ¨™å¤‰æ›
    return k * cos(A) * cos(B)
         - j * sin(A) * cos(B)
         + i * sin(B);
}
```

- **`i, j, k`** ãŒãã‚Œãã‚Œç‰©ä½“åº§æ¨™ç³»ã«ãŠã‘ã‚‹ X, Y, Z ã‚’è¡¨ã—ã€  
  ã“ã‚Œã‚‰ã‚’ **A, B, C** ã®å›è»¢åˆ†ã ã‘ãšã‚‰ã—ã¦æ–°ã—ã„ X, Y, Z ã‚’æ±‚ã‚ã¦ã„ã¾ã™ã€‚

```cpp
void calculateForSurface(float cubeX, float cubeY, float cubeZ, int ch) {
    x = calculateX(cubeX, cubeY, cubeZ);
    y = calculateY(cubeX, cubeY, cubeZ);
    z = calculateZ(cubeX, cubeY, cubeZ) + distanceFromCam;

    ooz = 1 / z;
    xp = (int)(width / 2 - 2 * cubeWidth + K1 * ooz * x * 2);
    yp = (int)(height / 2 + K1 * ooz * y);

    idx = xp + yp * width;
    if(idx >= 0 && idx < width * height) {
        if(ooz > zBuffer[idx]) {
            zBuffer[idx] = ooz;
            buffer[idx] = ch;
        }
    }
}
```

- å›è»¢å¾Œã® `(x, y, z)` ã‚’åŸºã«æŠ•å½±åº§æ¨™ `(xp, yp)` ã‚’è¨ˆç®—ã—ã€  
  è©²å½“ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ `idx` ã«æç”»ã™ã‚‹æ–‡å­— `ch` ã‚’è¨­å®šã—ã¾ã™ã€‚  
- **`if (ooz > zBuffer[idx])`** ã«ã‚ˆã£ã¦ã€ã‚ˆã‚Šæ‰‹å‰ã«ã‚ã‚‹ç”»ç´ ã®ã¿æç”»ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```cpp
while (1) {
    // ãƒãƒƒãƒ•ã‚¡ã®åˆæœŸåŒ–
    memset(buffer, backgroundASCIICode, width * height);
    memset(zBuffer, 0, width * height * sizeof(float));

    // ç«‹æ–¹ä½“å„é¢ã®ç‚¹ã‚’æç”»
    for(float cubeX = -cubeWidth; cubeX < cubeWidth; cubeX += incrementSpeed){
        for(float cubeY = -cubeWidth; cubeY < cubeWidth; cubeY += incrementSpeed){
            calculateForSurface(cubeX,  cubeY, -cubeWidth, '@');
            calculateForSurface(cubeWidth,  cubeY,  cubeX, '$');
            calculateForSurface(-cubeWidth, cubeY, -cubeX, '~');
            calculateForSurface(-cubeX,     cubeY,  cubeWidth, '#');
            calculateForSurface(cubeX,  -cubeWidth, -cubeY, ';');
            calculateForSurface(cubeX,   cubeWidth,  cubeY, '+');
        }
    }

    // æç”» (ãƒãƒƒãƒ•ã‚¡ã®å‡ºåŠ›)
    printf("[H");  // ã‚«ãƒ¼ã‚½ãƒ«ã‚’å…ˆé ­ã¸ç§»å‹•
    for(int k = 0; k < width * height; ++k){
        putchar(k % width ? buffer[k] : 10);
    }

    // å›è»¢è§’åº¦ã‚’æ›´æ–°
    A += 0.05;
    B += 0.05;
    C += 0.01;

    // é©åº¦ãªä¼‘æ­¢ (å›è»¢é€Ÿåº¦èª¿æ•´)
    usleep(8000 * 2);
}
```

- **`memset`** ã§ãƒãƒƒãƒ•ã‚¡ã‚’åˆæœŸåŒ–ã—ã€ç«‹æ–¹ä½“å„é¢ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚’æ›´æ–°ã—ã¦ã¯  
  ç”»é¢ã«å‡ºåŠ›ã™ã‚‹ãƒ«ãƒ¼ãƒ—ã‚’ç„¡é™ã«ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚  
- ãƒ«ãƒ¼ãƒ—å†…ã§å°‘ã—ãšã¤ **`A, B, C`** ã‚’å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ã§ã€å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚

---
